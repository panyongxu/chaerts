<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>ECharts 实现人民的名义关系图谱</title>
    <script src="jquery-1.10.2.min.js"></script>
    <script src="echarts.min.js"></script>
    <style type="text/css">
        html, body, #main { height: 100%; width: 100%; margin: 0; padding: 0 }
    </style>
</head>
<body>
    <div id="main" ></div>
    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById('main'));
        var symbolSize = 2;
        var link = [
                        {
                            source: '马云',
                            target: '阿里巴巴',
                            name: '参股',
                            des: '公司名:阿里巴巴, 创建时间:1999年 ',
                            lineStyle: {
                                normal: {
                                    type: 'dotted',
                                    color: '#000'
                                }
                            }
                        }, {
                            source: '马化腾',
                            target: '腾讯',
                            name: '参股',
                            path: '法人',
                            des: '公司名:腾讯, 创建时间:1998年 ',
                            lineStyle: {
                                normal: {
                                    type: 'dotted',
                                    color: '#000'
                                }
                            }
                        }, 
                        ]
        var nodes = [
                        {
                            name: '马云',
                            des: '年龄:53, 祖籍:杭州, 身份: 阿里巴巴董事长, 爱好: 太极拳',
                            itemStyle: {
                                normal: {
                                    color: 'red'
                                }
                            },
                            draggable: true
                        }, 
                        {
                            name: '马化腾',
                            des: '年龄:53, 祖籍:杭州, 身份: 阿里巴巴董事长, 爱好: 太极拳',
                            itemStyle: {
                                normal: {
                                    color: 'red'
                                }
                            }
                        }, 
                        {
                            name: '劉強東',
                            des: '年龄:53, 祖籍:杭州, 身份: 阿里巴巴董事长, 爱好: 太极拳',
                            itemStyle: {
                                normal: {
                                    color: 'red'
                                }
                            }
                        }, 
                        {
                            name: '腾讯',
                            des: '公司名:腾讯, 创建时间:1998年 ',
                        }, 
                        {
                            name: '阿里巴巴',
                            des: '公司名:阿里巴巴, 创建时间:1999年 ',
                        }, 
                    ]


            var isHighlight = false,clickLastNode = null;
            nodes = nodes.map(function(item){
                item.x = parseInt(Math.random()*650);
                item.y = parseInt(Math.random()*650);
                return item;
            })
            console.log(nodes);
            
        option = {
            // title: { text: '人民的名义关系图谱' },
            tooltip: {
                formatter: function (x) {
                    return x.data.des;
                }
            },
            series: [
                {
                    type: 'graph',
                    layout: 'none',
                    symbolSize: 80,
                    roam: true,
                    edgeSymbol: ['circle', 'arrow'],
                    edgeSymbolSize: [4, 10],
                    edgeLabel: {
                        normal: {
                            textStyle: {
                                fontSize: 20
                            }
                        }
                    },
                    force: {
                        initLayout: 'circular',
                        repulsion: 200,//斥力大小
                        edgeLength:100, //节点连线长度
                        layoutAnimation: false,
                        gravity: 0,
                    },
                    draggable: false,
                    legendHoverLink: false,
                    animation: false,
                    hoverAnimation: false,
                    focusNodeAdjacency: false,
                    itemStyle: {
                        normal: {
                            color: '#4b565b'
                        }
                    },
                    lineStyle: {
                        normal: {
                            width: 2,
                            color: '#4b565b',
                            // curveness: 0.3

                        }
                    },
                    edgeLabel: {
                        normal: {
                            show: true,
                            formatter: function (x) {
                                return x.data.name;
                            }
                        }
                    },
                    label: {
                        normal: {
                            show: true,
                            textStyle: {
                            }
                        }
                    },
                    emphasis: {
                            lineStyle: {
                                width: 500
                            }
                        },
                    draggable: true,
                    data: nodes,
                    links: link,
                }
            ]
        };

        myChart.setOption(option);
        



        upDataTuPu();
  function upDataTuPu () {
    myChart.setOption({
      graphic: echarts.util.map(nodes, function (item, dataIndex) {
        return {
          type: 'circle',
          shape: {
            r: 15
          },
          position: myChart.convertToPixel({seriesIndex: 0}, [item.x,item.y]),
          draggable: true,
          invisible: true,
          onclick: echarts.util.curry(circleClick,dataIndex),
          ondrag: echarts.util.curry(onPointDragging, dataIndex),
          z: 100,
        };
      })
    });
  };
  myChart.on('graphRoam', function () {
    updatePosition();
    rememberHighlight(clickLastNode);
  });
  function onPointDragging(dataIndex) {
    var tmpPos = myChart.convertFromPixel({seriesIndex: 0}, this.position);
    nodes[dataIndex].x = tmpPos[0];
    nodes[dataIndex].y = tmpPos[1];
    myChart.setOption({
      series: [{
        id: 'a',
        data: nodes
      }]
    });
    updatePosition();
    rememberHighlight(clickLastNode);
 
  }
  function circleClick(dataIndex) {
    if(!isHighlight){
      myChart.dispatchAction({
        type: 'focusNodeAdjacency',
        seriesId: option.series[0].id,
        dataIndex: dataIndex
      });
      isHighlight = true;
      clickLastNode = dataIndex;
    }
  };
  function updatePosition() {    //更新节点定位的函数
    myChart.setOption({
      graphic: echarts.util.map(nodes, function (item, dataIndex) {
        var tmpPos=myChart.convertToPixel({'seriesIndex': 0},[item.x,item.y]);
        return {
          position: tmpPos
        };
      })
    });
 
  };
  function rememberHighlight(clickLastNode){
    myChart.dispatchAction({
      type: 'focusNodeAdjacency',
      seriesId: option.series[0].id,
      dataIndex: clickLastNode
    });
  }
  // 点击空白区域复原
  myChart.getZr().on('click',function (params) {
    console.log('params',params);
    if(params.cancelBubble === false && params.target === undefined){
      updatePosition();
      isHighlight = false;
      clickLastNode = null;
    }
  })
    </script>
</body>
</html>
